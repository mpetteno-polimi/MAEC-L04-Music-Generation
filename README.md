# MAEC - L04-Project
Repository for Music and Acoustics Engineering Capstone 2022/23 Course

## Do Unconditional Deep Generative Models Spontaneously Learn How to Encode Human-Interpretable Musical Attributes?
Read the full project report [here](./assets/L04_Report.pdf).

## Abstract
Our study is focused on investigating the presence of any correlations between the topological structure of the latent space and high-level features of the output. 
This project supplies a valid starting point for the systematic sampling of the pre-trained model of MusicVAE, a beta Variational AutoEncoder by Magenta.
We offer ready-to-use tools for the analysis of the 2-bar and 16-bar pre-trained model configurations.
We employ Latin Hypercube Sampling to perform latent space regularization, which leads to an explicit control between the output’s characteristics and the locations of the samples
within the embedding. 
The available tools automate sampling, output feature calculations and evaluation.
The purpose of this work is to unveil the presence of eventual correlations between the topological structure of the latent space and high level features of the output, which could be relevant for future works involving the refining of post hoc conditioning in generative models.

## Environment

### Setup
1. Download and install [PyCharm IDE](https://www.jetbrains.com/pycharm/download/#section=linux).
2. Install [Conda](https://conda.io/projects/conda/en/stable/user-guide/install/index.html)
3. If running on Linux, install Magenta dependencies. Ubuntu/Debian based dìstros:
   - `sudo apt-get install build-essential libasound2-dev libjack-dev portaudio19-dev`
4. Create a new PyCharm project from this GIT repository.
    - From PyCharm's Welcome Screen &rarr; Get from VCS &rarr; Paste the link to this repository
5. Create the environment from the `environment.yml` file:
   - `. ./setup-environment.sh`
6. Configure the new environment as Python interpreter in PyCharm:
   - Settings &rarr; Project Interpreter &rarr; Add Interpreter &rarr; Add Local Interpreter &rarr; Conda Environment 
   &rarr; &rarr; Use Existing Environment
7. Download Magenta checkpoints that you need from [here](https://github.com/magenta/magenta/blob/main/magenta/models/music_vae/README.md#generate-script-w-pre-trained-models).

### Update
If you need a new package while developing, just update the content of the environment.yml file and run:
```shell script
conda env update --prefix ./venv --file environment.yml  --prune
```
More info on this process can be found [here](https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#updating-an-environment).

## Config
Create your `/config/config.ini` file from `/config/config.ini.sample`.
All options are displayed in the `[LatentSpaceSampling]` section. 
The available parameters are:
- `CHECKPOINT_FILE`: the path to the magenta model checkpoint file
- `MODEL_CONFIG`: the name of the magenta model configuration in use (must match checkpoint file)
- `NUM_BARS`: number of bars of music that are to be generated (must match model configuration)
- `N_GRID_POINTS`: number of latent space point generated by LHS
- `N_SAMPLES_PER_GRID_POINT`: number of latent space point sampled for each grid point
- `K_SIGMA`: factor for variance calculation used for gaussian sampling
- `GRID_WIDTH`: determines the width of the latent hypercube used for LHS
- `RAND_SEED`: random seed integer for deterministic results
- `TEMPERATURE`: generation temperature, must be > 0 (set very close to zero for deterministic results)
- `OUTPUT_DIR`: the path to the folder where results will be saved
- `LOG`: logging mode


## Scripts
The scripts require a file configuration file to be prepared in order to run correctly.
All scripts configurations are specified in this file.
If you want to launch a script in a terminal and not with PyCharm's run configurations, remember to add the project's 
root directory to the path.
Each of the following scripts requires the previous one to have been successfully run before.

```shell script
cd /path/to/project/root && export PYTHONPATH=.
```

### Sampling
`/scripts/latent_space_sampling.py`
Performs LHS driven latent space sampling and outputs corresponding MIDIs and latent space coordinates.

### Complexities
`/scripts/latent_space_complexities.py`
Computes MIDI files high-level features and stores them.

### Evaluation
`/scripts/latent_space_evaluation.py`
Evaluates the previously extracted features against the latent space sampling coordinates and saves the results.
